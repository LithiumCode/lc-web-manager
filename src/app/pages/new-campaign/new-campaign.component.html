<!-- Loading -->
<div *ngIf="isSaving" class="card-info loading-card">
    <div class="loader"></div>
    <p>Salvando campanha...</p>
</div>

<!-- Card de sucesso -->
<div *ngIf="successCampaign" class="card-info success-card">
    <h3>Campanha criada com sucesso!</h3>
    <ul>
        <li><b>Nome:</b> {{ successCampaign.name }}</li>
        <li><b>Tipo:</b> {{ successCampaign.mediaType }}</li>
        <li><b>Preço:</b> {{ successCampaign.price | currency:'BRL':'symbol':'1.0-0' }}</li>
        <li><b>Período:</b> {{ successCampaign.period }}</li>
        <li><b>Dias no ar:</b> {{ successCampaign.days }}</li>
        <li><b>Anunciante:</b> {{ successCampaign.client.razaoSocial }}</li>
        <li><b>Endereço:</b> {{ successCampaign.client.endereco }}</li>
        <li><b>Criado por:</b> {{ successCampaign.createdByName }}</li>
        <li><b>Status:</b> {{ successCampaign.status }}</li>
        <li><b>Data:</b> {{ successCampaign.createdAt | date:'dd/MM/yyyy' }}</li>
        <li><b>Mídia:</b> <a [href]="successCampaign.mediaUrl" target="_blank">Ver arquivo</a></li>
    </ul>
</div>
<!-- Card de erro -->
<div *ngIf="errorMsg && !isSaving" class="card-info error-card">
    <h3>Erro ao criar campanha</h3>
    <p>{{ errorMsg }}</p>
</div>
<form *ngIf="!isSaving && !successCampaign && !errorMsg" class="form-campaign-container" (ngSubmit)="submitCampaign()"
    autocomplete="off">
    <h2>Criar Nova Campanha</h2>

    <!-- 1. Buscar cliente por CNPJ -->
    <div class="form-group">
        <label>Buscar cliente por CNPJ</label>
        <div class="cnpj-row-centered">
            <input type="text" [(ngModel)]="cnpj" name="cnpj" placeholder="Digite o CNPJ" maxlength="18"
                (input)="maskCnpj($event)" required />
            <button type="button" class="btn-buscar" (click)="buscarClientePorCnpj()">Buscar</button>
        </div>
        <div *ngIf="clienteNaoEncontradoMsg" class="error-msg">{{ clienteNaoEncontradoMsg }}</div>
    </div>

    <!-- 2. Exibe dados do cliente e select de anúncio se cliente encontrado -->
    <ng-container *ngIf="cliente">
        <div class="form-group">
            <label>Razão Social</label>
            <input type="text" [value]="cliente.razaoSocial" readonly />
        </div>
        <div class="form-group">
            <label>Endereço</label>
            <input type="text" [value]="cliente.endereco" readonly />
        </div>
        <!-- Adicione outros campos do cliente se desejar -->

        <div class="form-group">
            <label>Selecione um anúncio</label>
            <select [(ngModel)]="selectedAd" name="selectedAd" (change)="onAdSelected()" required>
                <option value="" disabled selected>Escolha um anúncio</option>
                <option *ngFor="let ad of advertiser" [ngValue]="ad">{{ ad.type }}</option>
            </select>
        </div>
    </ng-container>

    <!-- 3. Exibe dados do anúncio selecionado -->
    <ng-container *ngIf="selectedAd">
        <div class="form-group">
            <label>Nome da campanha</label>
            <input type="text" [(ngModel)]="newCampaign.name" name="campaignName" required />
        </div>
        <div class="form-group">
            <label>Tipo do anúncio</label>
            <input type="text" [value]="selectedAd.type" readonly />
        </div>
        <div class="form-group">
            <label>Preço</label>
            <input type="text" [value]="selectedAd.price" readonly />
        </div>
        <div class="form-group">
            <label>Período</label>
            <input type="text" [value]="selectedAd.period" readonly />
        </div>
        <div class="form-group">
            <label>Dias no ar</label>
            <input type="number" [(ngModel)]="newCampaign.days" name="days" min="1" required />
        </div>
    </ng-container>

    <!-- 4. Exibe campo de mídia sempre que um anúncio for selecionado -->
    <ng-container *ngIf="selectedAd">
        <div class="form-group">
            <label>
                {{ selectedAd.type === 'video' ? 'Vídeo do anúncio' : 'Imagem do anúncio' }}
            </label>
            <input type="file" (change)="onMediaSelected($event)"
                [accept]="selectedAd?.type?.toLowerCase() === 'video' ? 'video/*' : 'image/png, image/jpeg'" required />
            <span *ngIf="newCampaign.media">{{ newCampaign.media?.name }}</span>
        </div>
    </ng-container>

    <!-- 5. Botões só aparecem se tudo estiver preenchido -->
    <div class="button-group" *ngIf="cliente && selectedAd && newCampaign.days && newCampaign.media">
        <button type="submit" class="btn-primary" [disabled]="isSaving">Salvar Campanha</button>
        <button type="button" class="btn-cancel" (click)="cancelNewCampaign()" [disabled]="isSaving">Cancelar</button>
    </div>
</form>